{% load leaflet_tags %}
<html>

<head>
  {% leaflet_js %} {% leaflet_css %}
  <style>
    .leaflet-container {
      height: 70%;
      width: 100%
    }
  </style>
  <script type="text/javascript">
    var dataurl = '{% url "data" %}';

    window.addEventListener("map:init", function (event) {
      var map = event.detail.map;
      // Download GeoJSON data with Ajax
      var myLines = [{
        "type": "LineString",
        "coordinates": [[-100, 40], [-105, 45], [-110, 55]]
      }, {
        "type": "LineString",
        "coordinates": [[-105, 40], [-110, 45], [-115, 55]]
      }];
      fetch(dataurl)
        .then(function (resp) {
          return resp.json();
        })
        .then(function (data) {
          L.geoJson(data, {
            onEachFeature: function onEachFeature(feature, layer) {
              var props = feature.properties;
              var content = `<img width="300" src="${props.picture_url}"/><h3>${props.title}</h3><p>${props.description}</p>`;
              layer.bindPopup(content);
            }
          }).addTo(map);
        });
         map.on('click', 
		 	function(e){
		 		var coord = e.latlng.toString().split(',');
		 		var lat = coord[0].split('(');
		 		var lng = coord[1].split(')');
		 		//alert("You clicked the map at LAT: " + lat[1] + " and LONG: " + lng[0]);
         document.getElementById("listpoint").value += lat[1]+","+lng[0]+";"; 
         L.marker(e.latlng).addTo(map);
		 	});
      var myLayer = L.geoJSON().addTo(map);
      myLayer.addData(myLines);
    });
  </script>
</head>

<body>
  <h1>Mushrooms Spots</h1>
  {% leaflet_map "main" %}

</body>

</html>